{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the LearnVerse AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "qualificationId": {
          "type": "string",
          "description": "Reference to Qualification. (Relationship: User 1:1 Qualification)"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "qualificationId"
      ]
    },
    "Qualification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Qualification",
      "type": "object",
      "description": "Represents the qualification level of a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the qualification."
        },
        "level": {
          "type": "string",
          "description": "Qualification level (e.g., 1st Grade, College, University)."
        }
      },
      "required": [
        "id",
        "level"
      ]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz within the LearnVerse AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quiz."
        },
        "qualificationId": {
          "type": "string",
          "description": "Reference to Qualification. (Relationship: Qualification 1:N Quiz)"
        },
        "difficulty": {
          "type": "string",
          "description": "Difficulty level of the quiz (e.g., Easy, Medium, Hard)."
        },
        "questions": {
          "type": "array",
          "description": "Array of question objects within the quiz.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "qualificationId",
        "difficulty",
        "questions"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question within a quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the question."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N Question)"
        },
        "questionText": {
          "type": "string",
          "description": "The text of the question."
        },
        "options": {
          "type": "array",
          "description": "Array of possible answers for the question.",
          "items": {
            "type": "string"
          }
        },
        "correctAnswer": {
          "type": "string",
          "description": "The correct answer to the question."
        }
      },
      "required": [
        "id",
        "quizId",
        "questionText",
        "options",
        "correctAnswer"
      ]
    },
    "UserProgress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProgress",
      "type": "object",
      "description": "Represents the progress of a user in the LearnVerse AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user progress record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 UserProgress)"
        },
        "totalQuizzes": {
          "type": "number",
          "description": "Total number of quizzes taken by the user."
        },
        "averageScore": {
          "type": "number",
          "description": "Average score of the user across all quizzes."
        }
      },
      "required": [
        "id",
        "userId",
        "totalQuizzes",
        "averageScore"
      ]
    },
    "Score": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Score",
      "type": "object",
      "description": "Represents the score of a user on a specific quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the score record."
        },
        "userProgressId": {
          "type": "string",
          "description": "Reference to UserProgress. (Relationship: UserProgress 1:N Score)"
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N Score)"
        },
        "score": {
          "type": "number",
          "description": "Score obtained by the user on the quiz."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the quiz was taken.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProgressId",
        "quizId",
        "score",
        "timestamp"
      ]
    },
    "Badge": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Badge",
      "type": "object",
      "description": "Represents a badge earned by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the badge."
        },
        "userProgressId": {
          "type": "string",
          "description": "Reference to UserProgress. (Relationship: UserProgress 1:N Badge)"
        },
        "badgeName": {
          "type": "string",
          "description": "Name of the badge (e.g., Quiz Master, Consistent Learner)."
        },
        "earnedDate": {
          "type": "string",
          "description": "Date when the badge was earned.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProgressId",
        "badgeName",
        "earnedDate"
      ]
    },
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents an entry in the leaderboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaderboard entry."
        },
        "userProgressId": {
          "type": "string",
          "description": "Reference to UserProgress. (Relationship: UserProgress 1:1 LeaderboardEntry)"
        },
        "totalScore": {
          "type": "number",
          "description": "Total score of the user on the leaderboard."
        },
        "qualificationId": {
          "type": "string",
          "description": "Reference to Qualification. (Relationship: Qualification 1:1 LeaderboardEntry)"
        }
      },
      "required": [
        "id",
        "userProgressId",
        "totalScore",
        "qualificationId"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents an AI-generated recommendation for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "userProgressId": {
          "type": "string",
          "description": "Reference to UserProgress. (Relationship: UserProgress 1:N Recommendation)"
        },
        "weakTopic": {
          "type": "string",
          "description": "Topic identified as a weak area for the user."
        },
        "suggestedNextLevel": {
          "type": "string",
          "description": "Suggested difficulty level for the next quiz."
        },
        "tip": {
          "type": "string",
          "description": "A helpful tip for the user to improve."
        }
      },
      "required": [
        "id",
        "userProgressId",
        "weakTopic",
        "suggestedNextLevel",
        "tip"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a message in the AI Tutor Chatbot.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "userProgressId": {
          "type": "string",
          "description": "Reference to UserProgress. (Relationship: UserProgress 1:N ChatMessage)"
        },
        "message": {
          "type": "string",
          "description": "Text of the message."
        },
        "sender": {
          "type": "string",
          "description": "Sender of the message (e.g., user or AI Tutor)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProgressId",
        "message",
        "sender",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}/profile",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "qualifications/{qualificationId}",
        "definition": {
          "entityName": "Qualification",
          "schema": {
            "$ref": "#/backend/entities/Qualification"
          },
          "description": "Stores qualification levels (e.g., 1st Grade, College).",
          "params": [
            {
              "name": "qualificationId",
              "description": "The unique identifier for the qualification."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/progress",
        "definition": {
          "entityName": "UserProgress",
          "schema": {
            "$ref": "#/backend/entities/UserProgress"
          },
          "description": "Stores the progress of each user. Path-based ownership ensures only the user can access their progress.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/badges/{badgeId}",
        "definition": {
          "entityName": "Badge",
          "schema": {
            "$ref": "#/backend/entities/Badge"
          },
          "description": "Stores badges earned by each user. Path-based ownership makes security rules straightforward.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "badgeId",
              "description": "The unique identifier for the badge."
            }
          ]
        }
      },
      {
        "path": "quizzes/{qualificationId}/{difficulty}/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quiz questions, categorized by qualification and difficulty level. The qualificationId is denormalized for authorization independence.",
          "params": [
            {
              "name": "qualificationId",
              "description": "The unique identifier for the qualification."
            },
            {
              "name": "difficulty",
              "description": "The difficulty level of the quiz (e.g., Easy, Medium, Hard)."
            },
            {
              "name": "quizId",
              "description": "The unique identifier for the quiz."
            }
          ]
        }
      },
      {
        "path": "leaderboard/{qualificationId}/{leaderboardEntryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Stores leaderboard entries, grouped by qualification. Includes denormalized `totalScore` and `qualificationId` for efficient querying and authorization independence.",
          "params": [
            {
              "name": "qualificationId",
              "description": "The unique identifier for the qualification."
            },
            {
              "name": "leaderboardEntryId",
              "description": "The unique identifier for the leaderboard entry."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores AI-generated recommendations for each user. This leverages path-based ownership for simple access control.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "recommendationId",
              "description": "The unique identifier for the recommendation."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/chats/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages for each user. Path-based ownership ensures only the user can access their chat logs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "chatMessageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, support the required QAPs (using segregation and path-based ownership), and maintain data integrity. The structure leverages path-based ownership and denormalization to avoid `get()` calls in security rules, ensuring atomic operations and simplifying security logic.\n\n*   **users/{userId}/profile:** Stores user profile information. This is a private data collection, secured via path-based ownership.\n*   **qualifications/{qualificationId}:** Stores qualification levels (e.g., 1st Grade, College). This collection may require more complex rules depending on who can create/modify qualifications. For simplicity, we assume only admins can manage these. To ensure Authorization Independence, the qualification level is denormalized to other relevant collections (UserProgress, LeaderboardEntry, Quizzes).\n*   **users/{userId}/progress:** Stores the progress of each user. This collection contains the average score and total number of quizzes taken.\n*   **users/{userId}/badges/{badgeId}:** Stores badges earned by each user. Path-based ownership makes security rules straightforward.\n*   **quizzes/{qualificationId}/{difficulty}/{quizId}:** Stores quiz questions, categorized by qualification and difficulty level. Since the qualification is part of the path, it is very easy to query for a quiz corresponding to a given qualification.\n*   **leaderboard/{qualificationId}/{leaderboardEntryId}:** Stores leaderboard entries, grouped by qualification. Includes denormalized `totalScore` and `qualificationId` for efficient querying and authorization independence.\n*   **users/{userId}/recommendations/{recommendationId}:** Stores AI-generated recommendations for each user. This leverages path-based ownership for simple access control.\n*   **users/{userId}/chats/{chatMessageId}:** Stores chat messages for each user.  Path-based ownership ensures only the user can access their chat logs.\n\nThis structure achieves Authorization Independence by avoiding `get()` calls in security rules. For instance, the `quizzes` subcollection denormalizes `qualificationId`, so rules can validate the user's qualification without needing to read the qualification document itself. Path-based ownership, used in `users/{userId}`, provides inherent ownership constraints without requiring additional reads. \n\nThis structure facilitates secure `list` operations (QAPs). By segregating data into collections with homogeneous security postures (e.g., private user data under `/users/{userId}`), rules can be written to allow listing only resources the user owns or has access to. The leaderboard is segregated by qualification so it can be queried for specific educational levels."
  }
}